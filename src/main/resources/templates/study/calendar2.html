<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Swithme Calendar</title>
  <link href="/webjars/fullcalendar/5.9.0/main.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- jQuery 로드 -->
  <script src="/webjars/fullcalendar/5.9.0/main.min.js"></script>
  <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: studies.map(function(study) {
          return {
            title: study.name,
            start: study.startTime,
            end: study.endTime,
            id: study.id
          };
        }),
        eventClick: function(info) {
          openStudyDetails(info.event.id);
        }
      });
      calendar2.render();
    });

    var studies = /*[[${studies}]]*/ [];

    function openStudyDetails(id) {
      $.get('/studies/details/' + id, function(data) {
        $('#study-details-body').html(data);
        $('#edit-button').attr('onclick', 'openEditForm(' + id + ')');
        $('#delete-button').attr('onclick', 'deleteStudy(' + id + ')');
        $('#study-details-modal').model('show');
      });
    }

    function openEditForm(id) {
      window.location.href = '/studies/edit/' + id;
    }

    function deleteStudy(id) {
      if (confirm('일정을 삭제하시겠습니까?')) {
        window.location.href = '/studies/delete/' + id;
      }
    }
  </script>
  <script th:src="@{/js/calendar.js}"></script>
</head>
<body>
<h1>Study Calendar</h1>
<div>
  <button type="button" class="btn btn-secondary" onclick="location.href='/studies/new'">일정 작성하기</button>
</div>

<div id="calendar"></div>

<div class="modal fade" id="study-details-modal" tabindex="-1" role="dialog" aria-labelledby="study-details-modal-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="study-details-modal-label">Study Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="study-details-body">
        <!-- 상세 정보가 표시될 공간 -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="edit-button">Edit</button>
        <button class="btn btn-danger" id="delete-button">Delete</button>
      </div>
    </div>
  </div>
</div>
</body>
</html>
